<%- include('../partials/header', { title: "Add Milestone", user: user || null }) %>

<div class="page-header">
    <h1>Add Milestone</h1>
    <p>Create a new milestone for a participant</p>
</div>

<div class="form-container">
    <form method="POST" action="/milestones/add">
        
        <!-- Participant dropdown (pre-selected if personid provided) -->
        <div class="form-group">
            <label for="personid">Select Participant *</label>
            <% if (selectedParticipant) { %>
                <!-- Show pre-selected participant as a single dropdown -->
                <select name="personid" id="personid" class="form-control" required>
                    <option value="<%= selectedParticipant.personid %>" selected>
                        <%= selectedParticipant.firstname %> <%= selectedParticipant.lastname %> - <%= selectedParticipant.email %>
                    </option>
                </select>
                <small style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                    Participant pre-selected from search
                </small>
            <% } else { %>
                <!-- Show full dropdown if no pre-selection -->
                <select name="personid" id="personid" class="form-control" required>
                    <option value="">Select a participant</option>
                    <% participants.forEach(p => { %>
                        <option value="<%= p.personid %>">
                            <%= p.firstname %> <%= p.lastname %> - <%= p.email %>
                        </option>
                    <% }) %>
                </select>
            <% } %>
        </div>

        <!-- Milestone title dropdown -->
        <div class="form-group">
            <label for="milestonetitle">Milestone Title *</label>
            <% if (milestoneOptions && milestoneOptions.length > 0) { %>
                <select name="milestonetitle" id="milestonetitle" class="form-control" required>
                    <option value="">Select a milestone title</option>
                    <% milestoneOptions.forEach(m => { %>
                        <option value="<%= m.milestonetitle %>"><%= m.milestonetitle %></option>
                    <% }) %>
                </select>
            <% } else { %>
                <input type="text" name="milestonetitle" id="milestonetitle" class="form-control" placeholder="Enter milestone title" required>
                <small style="color: var(--text-secondary); font-size: 0.85rem; display: block; margin-top: 0.25rem;">
                    No existing milestones found. Enter a new milestone title.
                </small>
            <% } %>
        </div>

        <!-- Milestone date (defaults to today) -->
        <div class="form-group">
            <label for="milestonedate">Milestone Date *</label>
            <input type="date" name="milestonedate" id="milestonedate" class="form-control" value="<%= new Date().toISOString().slice(0,10) %>" required>
        </div>

        <div class="form-actions">
            <button class="btn btn-primary" type="submit">Add Milestone</button>
            <a href="/milestones" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>


<%- include('../partials/footer') %>

<%- include('../partials/header', { title: "Edit Milestone", user: user || null }) %>

<div class="page-header">
    <h1>Edit Milestone</h1>
    <p>Update milestone for <%= person.firstname %> <%= person.lastname %></p>
</div>

<div class="form-container">
    <form method="POST" action="/milestones/edit/<%= milestone.milestoneid %>">
        <!-- Milestone title dropdown -->
        <div class="form-group">
            <label for="milestonetitle">Milestone Title *</label>
            <select name="milestonetitle" id="milestonetitle" class="form-control" required>
                <% milestoneOptions.forEach(m => { %>
                    <option value="<%= m.milestonetitle %>" <%= (m.milestonetitle === milestone.milestonetitle) ? 'selected' : '' %>>
                        <%= m.milestonetitle %>
                    </option>
                <% }) %>
            </select>
        </div>

        <!-- Milestone date -->
        <div class="form-group">
            <label for="milestonedate">Date Achieved *</label>
            <%
                let dateValue = '';
                if (milestone.milestonedate) {
                    // Handle date conversion - avoid timezone shifts by using local date
                    const date = milestone.milestonedate instanceof Date 
                        ? milestone.milestonedate 
                        : new Date(milestone.milestonedate);
                    // Format as YYYY-MM-DD using local date components to avoid timezone issues
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    dateValue = `${year}-${month}-${day}`;
                }
            %>
            <input type="date" id="milestonedate" name="milestonedate" class="form-control" 
                   value="<%= dateValue %>" required>
        </div>

        <div class="form-actions">
            <button class="btn btn-primary" type="submit">Save Changes</button>
            <a href="/milestones" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<%- include('../partials/footer') %>


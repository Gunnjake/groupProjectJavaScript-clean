<%- include('../partials/header', { title: "Survey Builder", user: user }) %>

<div class="page-header">
    <h1>Create Survey</h1>
    <p>Select an event to create a survey shell for participants.</p>
</div>

<div class="form-container" style="max-width: 600px; margin: 0 auto;">
    
    <!-- Flash Messages -->
    <% if (messages && messages.length > 0) { %>
        <% messages.forEach(msg => { %>
            <div class="alert alert-<%= msg.type === 'error' ? 'danger' : 'success' %>">
                <%= msg.text %>
            </div>
        <% }) %>
    <% } %>

    <form method="POST" action="/surveys/builder/save">
        
        <!-- Event dropdown -->
        <div class="form-group">
            <label for="eventid">Select Event *</label>
            <select name="eventid" id="eventid" class="form-control" required>
                <option value="">Choose an event...</option>

                <% events.forEach(e => { %>
                    <option value="<%= e.eventoccurrenceid %>">
                        <%= e.eventname %>
                        <% if (e.eventdatetimestart) { %>
                            - <%= new Date(e.eventdatetimestart).toISOString().slice(0,10) %>
                        <% } %>
                    </option>
                <% }) %>
            </select>
        </div>

        <div class="form-actions" style="margin-top: 1.5rem;">
            <button type="submit" class="btn btn-primary">Create Survey</button>
            <a href="/surveys" class="btn btn-secondary">Cancel</a>
        </div>

    </form>
</div>

<%- include('../partials/footer') %>

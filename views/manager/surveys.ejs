<%- include('../partials/header', { title: "Completed Surveys", user: user }) %>

<div class="page-header">
    <h1>Completed Surveys</h1>
    <p>View participant survey responses</p>
</div>

<!-- Search Bar -->
<div class="form-group" style="margin-bottom: 1.5rem;">
    <input id="surveySearch" type="text" class="form-control"
        placeholder="Search by participant, event, or date...">
</div>

<div class="table-container">
    <table id="surveyTable" class="table table-striped table-bordered" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="width: 180px;">Participant</th>
                <th style="width: 200px;">Event</th>
                <th style="width: 130px;">Date</th>
                <th style="width: 180px;">Scores</th>
                <th>Comments</th>
                <th style="width: 90px; text-align: center;">Delete</th>
            </tr>
        </thead>
        <tbody>
            <% if (surveys.length === 0) { %>
                <tr>
                    <td colspan="6" class="text-center">No surveys have been completed yet.</td>
                </tr>
            <% } else { %>
                <% surveys.forEach(s => { %>
                <tr style="vertical-align: top;">
                    <!-- Participant -->
                    <td style="padding: 12px; font-weight: 500;">
                        <%= s.participantname || s.personname %>
                    </td>

                    <!-- Event -->
                    <td style="padding: 12px;">
                        <%= s.eventname %>
                    </td>

                    <!-- Date -->
                    <td style="padding: 12px; white-space: nowrap;">
                        <%= s.eventdate %>
                    </td>

                    <!-- Scores in clean vertical list -->
                    <td style="padding: 12px; white-space: nowrap; line-height: 1.5;">
                        <strong>Sat:</strong> <%= s.surveysatisfactionscore || '—' %><br>
                        <strong>Use:</strong> <%= s.surveyusefulnessscore || '—' %><br>
                        <strong>Inst:</strong> <%= s.surveyinstructorscore || '—' %><br>
                        <strong>Rec:</strong> <%= s.surveyrecommendationscore || '—' %><br>
                        <strong>Ovrl:</strong> <%= s.surveyoverallscore || '—' %>
                    </td>

                    <!-- Comments formatted in a readable block -->
                    <td style="padding: 12px; line-height: 1.4;">
                        <% if (s.surveycomments && s.surveycomments.trim() !== "") { %>
                            <%= s.surveycomments %>
                        <% } else { %>
                            <span style="color: #888;">No comments</span>
                        <% } %>
                    </td>

                    <!-- Delete Button -->
                    <td style="padding: 12px; text-align: center;">
                        <form action="/surveys/<%= s.surveyid %>/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this survey? This action cannot be undone.');">
                            <button type="submit" class="btn btn-danger btn-sm" style="width: 70px;" aria-label="Delete survey">
                                Delete
                            </button>
                        </form>
                    </td>
                </tr>
                <% }) %>
            <% } %>
        </tbody>
    </table>
</div>

<style>
    table th {
        background: #f8f8f8;
        font-weight: 600;
        padding: 10px;
    }
    table td {
        padding: 10px;
    }

    /* Keep rows clean and evenly spaced */
    tbody tr {
        border-bottom: 1px solid #e5e5e5;
    }
</style>

<script>
// Live Search Filter
document.getElementById("surveySearch").addEventListener("input", function () {
    const term = this.value.toLowerCase();
    const rows = document.querySelectorAll("#surveyTable tbody tr");

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(term) ? "" : "none";
    });
});
</script>

<%- include('../partials/footer') %>

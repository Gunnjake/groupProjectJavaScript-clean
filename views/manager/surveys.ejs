<%- include('../partials/header', { title: "Completed Surveys", user: user }) %>

<div class="page-header">
    <h1>Completed Surveys</h1>
    <p>View participant survey responses</p>
</div>

<!-- Search Bar -->
<div class="form-group" style="margin-bottom: 1.5rem;">
    <input id="surveySearch" type="text" class="form-control"
        placeholder="Search by participant, event, or date...">
</div>

<div class="table-container">
    <table id="surveyTable">
        <thead>
            <tr>
                <th>Participant</th>
                <th>Event</th>
                <th style="width: 180px;">Date</th>
                <th>Scores</th>
                <th>Comments</th>
                <th style="width: 80px; text-align:center;">Delete</th>
            </tr>
        </thead>
        <tbody>
            <% if (surveys.length === 0) { %>
                <tr>
                    <td colspan="6" class="text-center">No surveys have been completed yet.</td>
                </tr>
            <% } else { %>
                <% surveys.forEach(s => { %>
                <tr>
                    <td><%= s.participantname %></td>
                    <td><%= s.eventname %></td>
                    <td style="width:180px; white-space:nowrap;"><%= s.eventdate %></td>
                    <td>
                        <div style="display: flex; flex-direction: column; gap: 0.25rem; font-size: 0.9rem;">
                            <span><strong>Sat:</strong> <%= s.surveysatisfactionscore || '—' %></span>
                            <span><strong>Use:</strong> <%= s.surveyusefulnessscore || '—' %></span>
                            <span><strong>Inst:</strong> <%= s.surveyinstructorscore || '—' %></span>
                            <span><strong>Rec:</strong> <%= s.surveyrecommendationscore || '—' %></span>
                            <span><strong>Ovrl:</strong> <%= s.surveyoverallscore || '—' %></span>
                        </div>
                    </td>
                    <td><%= s.surveycomments || "—" %></td>
                    <td style="width:80px; text-align:center;">
                        <form action="/surveys/<%= s.surveyid %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this survey? This action cannot be undone.');">
                            <button type="submit" class="btn btn-sm btn-danger" aria-label="Delete survey">Delete</button>
                        </form>
                    </td>
                </tr>
                <% }) %>
            <% } %>
        </tbody>
    </table>
</div>

<script>
// Live Search Filter
document.getElementById("surveySearch").addEventListener("input", function () {
    const term = this.value.toLowerCase();
    const rows = document.querySelectorAll("#surveyTable tbody tr");

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(term) ? "" : "none";
    });
});
</script>

<%- include('../partials/footer') %>

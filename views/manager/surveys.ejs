<%- include('../partials/header', { title: "Completed Surveys", user: user }) %>

<div class="page-header">
    <h1>Completed Surveys</h1>
    <p>View participant survey responses</p>
</div>

<!-- Search Bar -->
<div class="form-group" style="margin-bottom: 1.5rem;">
    <input id="surveySearch" type="text" class="form-control"
        placeholder="Search by participant, event, or date...">
</div>

<div class="table-container">
    <table id="surveyTable">
        <thead>
            <tr>
                <th>Participant</th>
                <th>Event</th>
                <th>Date</th>
                <th>Responses</th>
                <th>Comments</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <% if (surveys.length === 0) { %>
                <tr>
                    <td colspan="6" class="text-center">No surveys have been completed yet.</td>
                </tr>
            <% } else { %>
                <% surveys.forEach(s => { %>
                <tr>
                    <td><%= s.participantname %></td>
                    <td><%= s.eventname %></td>
                    <td><%= s.eventdate %></td>
                    <td>
                        Sat: <%= s.surveysatisfactionscore || '—' %> |
                        Use: <%= s.surveyusefulnessscore || '—' %> |
                        Inst: <%= s.surveyinstructorscore || '—' %> |
                        Rec: <%= s.surveyrecommendationscore || '—' %> |
                        Ovrl: <%= s.surveyoverallscore || '—' %>
                    </td>
                    <td><%= s.surveycomments || "—" %></td>
                    <td>
                        <div class="action-buttons">
                            <form action="/surveys/<%= s.surveyid %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this survey? This action cannot be undone.');">
                                <button type="submit" class="btn btn-sm btn-danger" aria-label="Delete survey">Delete</button>
                            </form>
                        </div>
                    </td>
                </tr>
                <% }) %>
            <% } %>
        </tbody>
    </table>
</div>

<script>
// Live Search Filter
document.getElementById("surveySearch").addEventListener("input", function () {
    const term = this.value.toLowerCase();
    const rows = document.querySelectorAll("#surveyTable tbody tr");

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(term) ? "" : "none";
    });
});
</script>

<%- include('../partials/footer') %>

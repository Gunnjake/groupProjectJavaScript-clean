<%- include('../partials/header', { title: 'User Maintenance - Ella Rises', user: typeof user !== 'undefined' ? user : null }) %>

<!-- User maintenance page - manager only -->
<div class="page-header">
    <h1>User Maintenance</h1>
    <p>Manage admins and volunteers (Manager Only)</p>
</div>

<!-- Search and add button -->
<div class="search-container">
    <form method="GET" action="/users" style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;">
        <label for="search-input" class="sr-only">Search users</label>
        <input 
            type="text" 
            id="search-input" 
            name="q"
            class="search-input" 
            placeholder="Search by name or email..." 
            aria-label="Search users by name or email"
            value="<%= typeof searchQuery !== 'undefined' ? searchQuery : '' %>"
            style="flex: 1; min-width: 200px;">
        <button type="submit" class="btn btn-secondary" aria-label="Search">Search</button>
        <% if (typeof searchQuery !== 'undefined' && searchQuery) { %>
            <a href="/users" class="btn btn-secondary" aria-label="Clear search">Clear</a>
        <% } %>
    </form>
    <a href="/users/new" class="btn btn-primary" aria-label="Add new user">Add New User</a>
</div>

<!-- Admins table -->
<h2 style="margin-top: 2rem; margin-bottom: 1rem;">Admins</h2>
<div class="table-container" role="region" aria-label="Admins table">
    <table aria-label="Admins">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Email</th>
                <th scope="col">Phone</th>
                <th scope="col">Location</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody id="admins-table-body">
            <% if (typeof admins !== 'undefined' && admins.length > 0) { %>
                <% admins.forEach(function(admin) { %>
                    <tr>
                        <td><%= (admin.FirstName || admin.firstname || '').trim() + ' ' + (admin.LastName || admin.lastname || '').trim() %></td>
                        <td><%= admin.Email || admin.email || 'N/A' %></td>
                        <td><%= admin.PhoneNumber || admin.phonenumber || 'N/A' %></td>
                        <td><%= (admin.City || admin.city || '') + (admin.State || admin.state ? ', ' + admin.State : '') %></td>
                        <td>
                            <a href="/users/<%= admin.PersonID || admin.personid || admin.id %>/edit" class="btn btn-sm btn-secondary" aria-label="Edit admin">Edit</a>
                            <form action="/users/<%= admin.PersonID || admin.personid || admin.id %>/delete" method="POST" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this admin?');" aria-label="Delete admin">Delete</button>
                            </form>
                        </td>
                    </tr>
                <% }); %>
            <% } else { %>
                <tr>
                    <td colspan="5" class="text-center" role="status" aria-live="polite">No admins found.</td>
                </tr>
            <% } %>
        </tbody>
    </table>
</div>

<!-- Volunteers table -->
<h2 style="margin-top: 2rem; margin-bottom: 1rem;">Volunteers</h2>
<div class="table-container" role="region" aria-label="Volunteers table">
    <table aria-label="Volunteers">
        <thead>
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Email</th>
                <th scope="col">Phone</th>
                <th scope="col">Location</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody id="volunteers-table-body">
            <% if (typeof volunteers !== 'undefined' && volunteers.length > 0) { %>
                <% volunteers.forEach(function(volunteer) { %>
                    <tr>
                        <td><%= (volunteer.FirstName || volunteer.firstname || '').trim() + ' ' + (volunteer.LastName || volunteer.lastname || '').trim() %></td>
                        <td><%= volunteer.Email || volunteer.email || 'N/A' %></td>
                        <td><%= volunteer.PhoneNumber || volunteer.phonenumber || 'N/A' %></td>
                        <td><%= (volunteer.City || volunteer.city || '') + (volunteer.State || volunteer.state ? ', ' + volunteer.State : '') %></td>
                        <td>
                            <a href="/users/<%= volunteer.PersonID || volunteer.personid || volunteer.id %>/edit" class="btn btn-sm btn-secondary" aria-label="Edit volunteer">Edit</a>
                            <form action="/users/<%= volunteer.PersonID || volunteer.personid || volunteer.id %>/delete" method="POST" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this volunteer?');" aria-label="Delete volunteer">Delete</button>
                            </form>
                        </td>
                    </tr>
                <% }); %>
            <% } else { %>
                <tr>
                    <td colspan="5" class="text-center" role="status" aria-live="polite">No volunteers found.</td>
                </tr>
            <% } %>
        </tbody>
    </table>
</div>

<%- include('../partials/footer') %>



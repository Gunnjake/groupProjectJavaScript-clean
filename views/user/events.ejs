<%- include('../partials/header', { title: 'Events - Ella Rises', user: typeof user !== 'undefined' ? user : null }) %>

<!-- Events page - card-based UI for users -->
<div class="page-header">
    <h1>Upcoming Events</h1>
    <p>Discover our upcoming programs and workshops</p>
</div>

<!-- Flash messages -->
<% if (typeof messages !== 'undefined' && messages.length > 0) { %>
    <% messages.forEach(function(message) { %>
        <div class="flash-message flash-<%= message.type %>" style="max-width: 1200px; margin: 1rem auto; padding: 0 2rem;">
            <%= message.text %>
        </div>
    <% }); %>
<% } %>

<div style="max-width: 1200px; margin: 2rem auto; padding: 0 2rem;">
    <!-- Search bar -->
    <div style="margin-bottom: 2rem;">
        <input type="text" id="search-input" class="search-input" placeholder="Search events by name, type, or location..." style="width: 100%; max-width: 500px; margin: 0 auto; display: block;">
    </div>

    <!-- Events grid -->
    <% if (typeof events !== 'undefined' && events.length > 0) { %>
        <div class="events-grid" id="events-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem;">
            <!-- Event cards -->
            <% events.forEach(function(event) { %>
                <div class="event-card" style="background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'">
                    <div style="background: linear-gradient(135deg, var(--coral), var(--accent-peach)); padding: 1.5rem; color: white;">
                        <div style="display: inline-block; background: rgba(255,255,255,0.2); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; margin-bottom: 0.75rem; font-weight: 600;">
                            <%= event.EventType || event.event_type || 'Event' %>
                        </div>
                        <h3 style="margin: 0; font-size: 1.5rem; font-weight: 700; color: white;"><%= event.EventName || event.event_name %></h3>
                    </div>
                    <div style="padding: 1.5rem;">
                        <% 
                            const eventDate = event.EventDate || event.event_date;
                            let formattedDate = 'Date TBA';
                            if (eventDate) {
                                try {
                                    const date = new Date(eventDate);
                                    formattedDate = date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                                } catch(e) {
                                    formattedDate = eventDate;
                                }
                            }
                        %>
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; margin-bottom: 0.5rem; color: var(--text-dark);">
                                <strong style="color: var(--coral); margin-right: 0.5rem;">üìÖ Date:</strong>
                                <span><%= formattedDate %></span>
                            </div>
                            <% if (event.Location || event.location) { %>
                                <div style="display: flex; align-items: center; color: var(--text-dark);">
                                    <strong style="color: var(--coral); margin-right: 0.5rem;">üìç Location:</strong>
                                    <span><%= event.Location || event.location %></span>
                                </div>
                            <% } %>
                        </div>
                        <% if (event.Description || event.description) { %>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; margin-bottom: 1rem;">
                                <%= (event.Description || event.description).substring(0, 150) %><% if ((event.Description || event.description).length > 150) { %>...<% } %>
                            </p>
                        <% } %>
                        <a href="/register" class="btn btn-primary" style="width: 100%; text-align: center; display: block; text-decoration: none;">Register Now</a>
                    </div>
                </div>
            <% }); %>
        </div>
    <% } else { %>
        <div style="text-align: center; padding: 4rem 2rem; background: var(--pink-bg); border-radius: 12px;">
            <p style="font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 1rem;">No events available at this time.</p>
            <p style="color: var(--text-secondary);">Check back soon for upcoming programs and workshops!</p>
        </div>
    <% } %>
</div>

<script>
    // Search functionality
    document.getElementById('search-input')?.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const eventCards = document.querySelectorAll('.event-card');
        
        eventCards.forEach(card => {
            const text = card.textContent.toLowerCase();
            card.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    });
</script>

<style>
    .events-grid {
        animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @media (max-width: 768px) {
        .events-grid {
            grid-template-columns: 1fr !important;
        }
    }
</style>

<%- include('../partials/footer') %>


